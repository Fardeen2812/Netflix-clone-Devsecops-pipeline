services:
  catalog-service:
    image: catalog-service
    container_name: catalog-service
    ports:
      - "8081:8081"
    environment:
      TMDB_API_KEY: ${TMDB_API_KEY}
    healthcheck:
      test:
        [
          "CMD",
          "node",
          "-e",
          "require('http').get('http://localhost:8081/health', r => process.exit(r.statusCode === 200 ? 0 : 1)).on('error', () => process.exit(1))"
        ]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  api-gateway:
    image: api-gateway
    container_name: api-gateway
    ports:
      - "8080:8080"
    environment:
      CATALOG_SERVICE_URL: http://catalog-service:8081
    depends_on:
      catalog-service:
        condition: service_healthy
    restart: unless-stopped
